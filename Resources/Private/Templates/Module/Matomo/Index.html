<f:layout name="Default" />

<f:section name="Title">
	<br>
	<img src="{f:uri.resource(path: 'resource://Flowpack.Neos.Matomo/Public/Images/matomo-white.svg')}" alt="Matomo Logo">
	<br><br>
	<h1>Matomo Host Information</h1>
	<br>
</f:section>
<f:section name="Content">
	<div class="neos-row-fluid">
		<div class="neos-span4">
			<div class="neos-breadcrumb"></div>
			<table>
				<tr>
					<th>IP Address:</th>
					<td>
						<f:for each="{matomoHost.ip}" as="ip">
							{ip}<br>
						</f:for>
					</td>
				</tr>
				<tr>
					<th>Version:</th>
					<td>{matomoHost.version.value}</td>
				</tr>
			</table>
		</div>
	</div>
	<f:form action="update" name="matomo" object="{settings}">
		<fieldset>
			<div class="neos-row-fluid">
				<fieldset class="neos-span4">
					<br>
					<h1>Configuration</h1>
					<br>
					<div class="neos-control-group">
						<label class="neos-control-label" for="host">Host</label>
						<div class="neos-controls">
							<f:form.textfield property="host" id="host" class="neos-span12" required="true" />
						</div>
					</div>
					<div class="neos-controls">
						<br>
						<label class="neos-control-label" for="protocol">Protocol </label>
						<label class="neos-radio neos-inline" for="https_protocol">
							<f:form.radio property="protocol" id="https_protocol" value="https"
										  checked="{settings.protocol} == 'https'"/> https
							<span></span>
						</label>
						<label class="neos-radio neos-inline " for="http_protocol" >
							<f:form.radio property="protocol" id="http_protocol"
										  value="http" checked="{settings.protocol} == 'http'" /> http
							<span></span>
						</label>
						<span data-toggle="modal" class="neos-inline neos-button neos-button-small"
							  href="#protocol-modal">?</span>
					</div>
					<div class="neos-hide" id="protocol-modal">
						<div class="neos-modal">
							<div class="neos-modal-header">
								<button type="button" class="neos-close neos-button" data-dismiss="modal"></button>
								<div class="neos-header">Warning</div>
							</div>
							<div class="neos-subheader">
								<p>
									 Be aware that using <b>HTTP</b> for communication with your Matomo host
									<b>{settings.host}</b> will result in your super user's auth_token being transmitted as an unencrypted URL parameter!
									<br>
									<br>
								</p>
							</div>
							<div class="neos-modal-footer">
								<a href="#" class="neos-button" data-dismiss="modal">OK</a>
							</div>
						</div>
						<div class="neos-modal-backdrop neos-in"></div>
					</div>

					<div class="neos-control-group">
						<br>
						<label class="neos-control-label" for="token_auth">Token</label>
						<div class="neos-controls">
							<f:form.textfield property="token_auth" id="token_auth" class="neos-span12" required="true" />
						</div>
						<p>
							<small>
								Please enter a superusers's token!
							</small>
						</p>
					</div>
					<f:if condition="{settings.token_auth}">
						<div class="neos-control-group">
							<br>
							<label class="neos-control-label" for="idSite">Matomo Site to use for this Neos installation:</label>
							<f:if condition="{matomoError}">
								<f:then>
									<i>{matomoError}</i>
								</f:then>
								<f:else>
									<div class="neos-controls">
										<select name="moduleArguments[matomo][idSite]" id="idSite" class="neos-span12" >
											<f:for each="{matomoHost.sites}" as="site">
												<option value="{site.idsite}"
														{f:if(condition:'{settings.idSite} == {site.idsite}',then:'selected="selected"')}>
												{site.name}</option>
											</f:for>
										</select>
									</div>
								</f:else>
							</f:if>
						</div>
					</f:if>
				</fieldset>

				<fieldset class="neos-span7 neos-offset1">
					<legend>Site Settings</legend>

					<f:if condition="{matomoError}">
						<f:then>
							<i>{matomoError}</i>
						</f:then>
						<f:else>
							<table class="neos-table">
								<thead>
								<tr>
									<th>ID</th>
									<th>Name</th>
									<th colspan="2">Url</th>
								</tr>
								</thead>
								<tbody>
								<f:for each="{matomoHost.sites}" as="site" key="number">
									<tr>
										<td>{site.idsite}</td>
										<td>{site.name}</td>
										<td>{site.main_url}</td>
										<td class="neos-action">
											<div class="neos-pull-right">
												<f:link.action action="editSite" arguments="{matomoSite: site}" class="neos-button neos-button-primary" title="Click to edit">
													<i class="icon-pencil icon-white"></i>
												</f:link.action>
											</div>
										</td>
									</tr>
								</f:for>
								</tbody>
							</table>
						</f:else>
					</f:if>
				</fieldset>
			</div>

			<div class="neos-footer">
				<f:form.submit value="Update Matomo Host" class="neos-button neos-button-primary" />
			</div>
		</fieldset>
	</f:form>
	<f:form action="index" id="postHelper" method="post"></f:form>
</f:section>
